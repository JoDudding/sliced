---
title: SLICED s01e02
author: Jo Dudding
output: 
  html_document:
    theme: united
    highlight: kate
    toc: true
    toc_float: 
      collapsed: true
    includes:
      in_header: "header.html"
      after_body: "footer.html"
    keep_md: true  

---



<style type="text/css">
h1, h2, h3, h4, h5, h6, legend {
  color: #302df0;
}

h1.title {
    font-size: 38px;
    background-color: #e946a5;
    color: #ffffff;
    margin-bottom: 20px;
    padding: 9.5px;
    padding-top: 20px;
    padding-bottom: 20px;
    border-radius: 10px;
}

pre {
  background-color: #cccccc;
}

a {
  color: #129875;
}

.hljs-comment {
    color: #68e199;
    font-style: 68e199;
}

.list-group-item.active, .list-group-item.active:hover, .list-group-item.active:focus {
    z-index: 2;
    color: #ffffff;
    background-color: #68e199;
    border-color: #68e199;
}
</style>

Predict whether an aircraft strike with wildlife causes damage

[Kaggle link](https://www.kaggle.com/c/sliced-s01e02-xunyc5)

[Twitch link](https://www.twitch.tv/nickwan_datasci)

This time I'm trying an XGBoost model.

# Load libraries


```r
library(tidyverse)
library(tidymodels)
library(scales)
library(skimr)
library(kableExtra)
library(patchwork)
library(gt)
library(lubridate)
library(glue)
library(themis)
library(credentials)
```

# My settings


```r
# colours
#pal_jo <- c(viridisLite::magma(8)[2:8], "#4C4C53", "#9B9BA8")

pal_sliced <- c(
  '#e946a5', # pink
  '#68e199', # green
  '#302df0', # blue
  '#6a45b0', # purple
  '#129875', # darker green
  '#4f94bf', # lighter blue
  '#b545ab', # darker pink
  '#000000', # black,
  '#cccccc'  #grey
)

title_colour <- pal_sliced[1]
table_colour <- pal_sliced[4]
bar_colour <- pal_sliced[2]
grid_colour <- pal_sliced[9]

theme_set(theme_bw() %+replace%
    theme(
      # align title and caption to the plot not the panel
      plot.title.position = 'plot',
      plot.caption.position = 'plot',
      # change the title and caption to markdown and move them futher from the plot
      plot.title = element_text(
        size = rel(1.3),
        hjust = 0, 
        margin = margin(c(0, 0, 10, 0)),
        colour = title_colour
      ),
      plot.subtitle = element_text(
        size = rel(1.15),
        hjust = 0, 
        margin = margin(c(0, 0, 15, 0))
      ),
      plot.caption = element_text(
        hjust = 1, 
        margin = margin(c(10, 0, 0, 0))
      ),
      # move axis titles to the left/top and change them to markdown
      axis.title = element_text(hjust = 1),
      # allow the axis values to the markdown as well
      axis.text = element_text(),
      # remove the panel border
      panel.border = element_blank(),
      # put in the axis lines with a slightly thicker line than the gridlines
      axis.line = element_line(colour = grid_colour, size = rel(1.5)),
      # make the tickmarks the same colour
      axis.ticks = element_line(colour = grid_colour),
      # facet strip text left aligned with extra space above
      strip.text = element_text(
        hjust = 0, margin = margin(c(10, 0, 0, 0)), colour = title_colour
      ),
      # clear colour and fill for strip
      strip.background = element_rect(colour = NA, fill = NA),
      # dotted gridlines
      panel.grid = element_line(linetype = 'dotted'),
      # ability to use a different colour for the gridlines
      panel.grid.major.x = element_line(colour = grid_colour),
      panel.grid.major.y = element_line(colour = grid_colour),
      panel.grid.minor.x = element_blank(),
      panel.grid.minor.y = element_blank(),
    )
)

scale_y_pct <- function(
  accuracy = 1L, 
  breaks = pretty_breaks(),
  expand = expansion(mult = c(0, .05)),
  ...
) {
  scale_y_continuous(
    labels = scales::percent_format(accuracy = accuracy, big.mark = ","),
    breaks = breaks,
    expand = expand,
    ...
  )
}

scale_y_comma <- function(
  accuracy = 1L, 
  breaks = pretty_breaks(),
  expand = expansion(mult = c(0, .05)),
  ...
) {
  scale_y_continuous(
    labels = scales::comma_format(accuracy = accuracy),
    breaks = breaks,
    expand = expand,
    ...
  )
}

scale_fill_jo <- function(...) {
  scale_fill_manual(values = pal_sliced, ...)
}

scale_fill_discrete <- scale_fill_jo

update_geom_defaults("bar", list(fill = bar_colour))
update_geom_defaults("col", list(fill = bar_colour))
update_geom_defaults("point", list(colour = bar_colour))
update_geom_defaults("line", list(colour = bar_colour))
```


# Read files


```r
to_build <- read_csv("s01e02/train.csv", guess_max = 200000) 
```

```

── Column specification ────────────────────────────────────────────────────────
cols(
  .default = col_character(),
  id = col_double(),
  incident_year = col_double(),
  incident_month = col_double(),
  incident_day = col_double(),
  aircraft_model = col_double(),
  aircraft_mass = col_double(),
  engine_make = col_double(),
  engines = col_double(),
  engine1_position = col_double(),
  engine2_position = col_double(),
  engine4_position = col_double(),
  height = col_double(),
  speed = col_double(),
  distance = col_double(),
  damaged = col_double()
)
ℹ Use `spec()` for the full column specifications.
```

```r
to_score <- read_csv("s01e02/test.csv", guess_max = 200000) 
```

```

── Column specification ────────────────────────────────────────────────────────
cols(
  .default = col_character(),
  id = col_double(),
  incident_year = col_double(),
  incident_month = col_double(),
  incident_day = col_double(),
  aircraft_model = col_double(),
  aircraft_mass = col_double(),
  engine_make = col_double(),
  engines = col_double(),
  engine1_position = col_double(),
  engine2_position = col_double(),
  engine4_position = col_double(),
  height = col_double(),
  speed = col_double(),
  distance = col_double()
)
ℹ Use `spec()` for the full column specifications.
```

# Examine data


```r
skim(to_build)
```


<table style='width: auto;'
        class='table table-condensed'>
<caption>Data summary</caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;">   </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Name </td>
   <td style="text-align:left;"> to_build </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of rows </td>
   <td style="text-align:left;"> 21000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of columns </td>
   <td style="text-align:left;"> 34 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> _______________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Column type frequency: </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> character </td>
   <td style="text-align:left;"> 19 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> numeric </td>
   <td style="text-align:left;"> 15 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ________________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Group variables </td>
   <td style="text-align:left;"> None </td>
  </tr>
</tbody>
</table>


**Variable type: character**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:right;"> min </th>
   <th style="text-align:right;"> max </th>
   <th style="text-align:right;"> empty </th>
   <th style="text-align:right;"> n_unique </th>
   <th style="text-align:right;"> whitespace </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> operator_id </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 276 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> operator </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 33 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 275 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> aircraft </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 424 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> aircraft_type </td>
   <td style="text-align:right;"> 4992 </td>
   <td style="text-align:right;"> 0.76 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> aircraft_make </td>
   <td style="text-align:right;"> 5231 </td>
   <td style="text-align:right;"> 0.75 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 62 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine_model </td>
   <td style="text-align:right;"> 6334 </td>
   <td style="text-align:right;"> 0.70 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 39 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine_type </td>
   <td style="text-align:right;"> 5703 </td>
   <td style="text-align:right;"> 0.73 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine3_position </td>
   <td style="text-align:right;"> 19671 </td>
   <td style="text-align:right;"> 0.06 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> airport_id </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1039 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> airport </td>
   <td style="text-align:right;"> 34 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 53 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1038 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> state </td>
   <td style="text-align:right;"> 2664 </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 60 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> faa_region </td>
   <td style="text-align:right;"> 2266 </td>
   <td style="text-align:right;"> 0.89 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> flight_phase </td>
   <td style="text-align:right;"> 6728 </td>
   <td style="text-align:right;"> 0.68 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> visibility </td>
   <td style="text-align:right;"> 7699 </td>
   <td style="text-align:right;"> 0.63 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> precipitation </td>
   <td style="text-align:right;"> 10327 </td>
   <td style="text-align:right;"> 0.51 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 15 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> species_id </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 447 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> species_name </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 50 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 445 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> species_quantity </td>
   <td style="text-align:right;"> 532 </td>
   <td style="text-align:right;"> 0.97 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> flight_impact </td>
   <td style="text-align:right;"> 8944 </td>
   <td style="text-align:right;"> 0.57 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 21 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
</tbody>
</table>


**Variable type: numeric**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:right;"> mean </th>
   <th style="text-align:right;"> sd </th>
   <th style="text-align:right;"> p0 </th>
   <th style="text-align:right;"> p25 </th>
   <th style="text-align:right;"> p50 </th>
   <th style="text-align:right;"> p75 </th>
   <th style="text-align:right;"> p100 </th>
   <th style="text-align:left;"> hist </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> id </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 14980.94 </td>
   <td style="text-align:right;"> 8663.24 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 7458.75 </td>
   <td style="text-align:right;"> 14978.5 </td>
   <td style="text-align:right;"> 22472.25 </td>
   <td style="text-align:right;"> 30000 </td>
   <td style="text-align:left;"> ▇▇▇▇▇ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> incident_year </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 2006.06 </td>
   <td style="text-align:right;"> 6.72 </td>
   <td style="text-align:right;"> 1990 </td>
   <td style="text-align:right;"> 2001.00 </td>
   <td style="text-align:right;"> 2007.0 </td>
   <td style="text-align:right;"> 2012.00 </td>
   <td style="text-align:right;"> 2015 </td>
   <td style="text-align:left;"> ▂▃▅▆▇ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> incident_month </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 7.19 </td>
   <td style="text-align:right;"> 2.79 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 5.00 </td>
   <td style="text-align:right;"> 8.0 </td>
   <td style="text-align:right;"> 9.00 </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:left;"> ▃▅▆▇▆ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> incident_day </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 15.63 </td>
   <td style="text-align:right;"> 8.82 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 8.00 </td>
   <td style="text-align:right;"> 15.0 </td>
   <td style="text-align:right;"> 23.00 </td>
   <td style="text-align:right;"> 31 </td>
   <td style="text-align:left;"> ▇▇▇▇▆ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> aircraft_model </td>
   <td style="text-align:right;"> 6259 </td>
   <td style="text-align:right;"> 0.70 </td>
   <td style="text-align:right;"> 24.65 </td>
   <td style="text-align:right;"> 21.70 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 10.00 </td>
   <td style="text-align:right;"> 22.0 </td>
   <td style="text-align:right;"> 37.00 </td>
   <td style="text-align:right;"> 98 </td>
   <td style="text-align:left;"> ▇▆▂▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> aircraft_mass </td>
   <td style="text-align:right;"> 5694 </td>
   <td style="text-align:right;"> 0.73 </td>
   <td style="text-align:right;"> 3.50 </td>
   <td style="text-align:right;"> 0.89 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3.00 </td>
   <td style="text-align:right;"> 4.0 </td>
   <td style="text-align:right;"> 4.00 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:left;"> ▁▁▂▇▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine_make </td>
   <td style="text-align:right;"> 6155 </td>
   <td style="text-align:right;"> 0.71 </td>
   <td style="text-align:right;"> 21.22 </td>
   <td style="text-align:right;"> 11.04 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 10.00 </td>
   <td style="text-align:right;"> 22.0 </td>
   <td style="text-align:right;"> 34.00 </td>
   <td style="text-align:right;"> 47 </td>
   <td style="text-align:left;"> ▇▂▆▇▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engines </td>
   <td style="text-align:right;"> 5696 </td>
   <td style="text-align:right;"> 0.73 </td>
   <td style="text-align:right;"> 2.05 </td>
   <td style="text-align:right;"> 0.46 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2.00 </td>
   <td style="text-align:right;"> 2.0 </td>
   <td style="text-align:right;"> 2.00 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:left;"> ▁▇▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine1_position </td>
   <td style="text-align:right;"> 5838 </td>
   <td style="text-align:right;"> 0.72 </td>
   <td style="text-align:right;"> 2.99 </td>
   <td style="text-align:right;"> 2.09 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1.0 </td>
   <td style="text-align:right;"> 5.00 </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:left;"> ▇▁▂▅▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine2_position </td>
   <td style="text-align:right;"> 6776 </td>
   <td style="text-align:right;"> 0.68 </td>
   <td style="text-align:right;"> 2.91 </td>
   <td style="text-align:right;"> 2.01 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1.0 </td>
   <td style="text-align:right;"> 5.00 </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:left;"> ▇▁▂▅▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine4_position </td>
   <td style="text-align:right;"> 20650 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 2.02 </td>
   <td style="text-align:right;"> 1.43 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1.0 </td>
   <td style="text-align:right;"> 4.00 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:left;"> ▇▁▁▃▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> height </td>
   <td style="text-align:right;"> 8469 </td>
   <td style="text-align:right;"> 0.60 </td>
   <td style="text-align:right;"> 819.24 </td>
   <td style="text-align:right;"> 1772.53 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 50.0 </td>
   <td style="text-align:right;"> 800.00 </td>
   <td style="text-align:right;"> 24000 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> speed </td>
   <td style="text-align:right;"> 12358 </td>
   <td style="text-align:right;"> 0.41 </td>
   <td style="text-align:right;"> 141.39 </td>
   <td style="text-align:right;"> 52.25 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 120.00 </td>
   <td style="text-align:right;"> 137.0 </td>
   <td style="text-align:right;"> 160.00 </td>
   <td style="text-align:right;"> 2500 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> distance </td>
   <td style="text-align:right;"> 8913 </td>
   <td style="text-align:right;"> 0.58 </td>
   <td style="text-align:right;"> 0.66 </td>
   <td style="text-align:right;"> 3.33 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 100 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> damaged </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 0.09 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
</tbody>
</table>

<br>
Initial thoughts

- Lots of missing values!
- Some of the character variables have lots of categories
- Missing value for the target variable


```r
explore_build <- to_build %>% 
  filter(! is.na(damaged)) %>% 
  mutate(
    damaged_factor = factor(if_else(damaged == 1, 'Damaged', 'Not Damaged')),
    date = ymd(paste(incident_year, incident_month, incident_day, 
      sep = '-')),
    dow = wday(date, label = TRUE, abbr = TRUE),
    log_height= log(height),
    log_speed= log(speed),
    log_distance = log(distance),
    aircraft_mass = factor(aircraft_mass)
  )
```

## Look at sample


```r
set.seed(617)

explore_build %>% 
  select(damaged, damaged_factor, everything()) %>% 
  slice_sample(n = 5) %>% 
  gather(-id, key = 'key', value = 'value') %>% 
  spread(key = id, value = value) %>% 
  arrange(-str_detect(key, 'damag')) %>% 
  gt()
```

```{=html}
<div id="qasksgcxru" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#qasksgcxru .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qasksgcxru .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qasksgcxru .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qasksgcxru .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qasksgcxru .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qasksgcxru .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qasksgcxru .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qasksgcxru .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qasksgcxru .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qasksgcxru .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qasksgcxru .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qasksgcxru .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#qasksgcxru .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qasksgcxru .gt_from_md > :first-child {
  margin-top: 0;
}

#qasksgcxru .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qasksgcxru .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qasksgcxru .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#qasksgcxru .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qasksgcxru .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#qasksgcxru .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qasksgcxru .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qasksgcxru .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qasksgcxru .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qasksgcxru .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qasksgcxru .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#qasksgcxru .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qasksgcxru .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#qasksgcxru .gt_left {
  text-align: left;
}

#qasksgcxru .gt_center {
  text-align: center;
}

#qasksgcxru .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qasksgcxru .gt_font_normal {
  font-weight: normal;
}

#qasksgcxru .gt_font_bold {
  font-weight: bold;
}

#qasksgcxru .gt_font_italic {
  font-style: italic;
}

#qasksgcxru .gt_super {
  font-size: 65%;
}

#qasksgcxru .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">key</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">8896</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">17349</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">20384</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">21944</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">23470</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">damaged</td>
<td class="gt_row gt_left">0</td>
<td class="gt_row gt_left">0</td>
<td class="gt_row gt_left">0</td>
<td class="gt_row gt_left">0</td>
<td class="gt_row gt_left">0</td></tr>
    <tr><td class="gt_row gt_left">damaged_factor</td>
<td class="gt_row gt_left">Not Damaged</td>
<td class="gt_row gt_left">Not Damaged</td>
<td class="gt_row gt_left">Not Damaged</td>
<td class="gt_row gt_left">Not Damaged</td>
<td class="gt_row gt_left">Not Damaged</td></tr>
    <tr><td class="gt_row gt_left">aircraft</td>
<td class="gt_row gt_left">DHC8 DASH 8</td>
<td class="gt_row gt_left">B-767-200</td>
<td class="gt_row gt_left">UNKNOWN</td>
<td class="gt_row gt_left">UNKNOWN</td>
<td class="gt_row gt_left">C-560</td></tr>
    <tr><td class="gt_row gt_left">aircraft_make</td>
<td class="gt_row gt_left">303</td>
<td class="gt_row gt_left">148</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">226</td></tr>
    <tr><td class="gt_row gt_left">aircraft_mass</td>
<td class="gt_row gt_left">3</td>
<td class="gt_row gt_left">4</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">1</td></tr>
    <tr><td class="gt_row gt_left">aircraft_model</td>
<td class="gt_row gt_left">10</td>
<td class="gt_row gt_left">29</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">45</td></tr>
    <tr><td class="gt_row gt_left">aircraft_type</td>
<td class="gt_row gt_left">A</td>
<td class="gt_row gt_left">A</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">A</td></tr>
    <tr><td class="gt_row gt_left">airport</td>
<td class="gt_row gt_left">BRADLEY INTL</td>
<td class="gt_row gt_left">UNKNOWN</td>
<td class="gt_row gt_left">GEORGE BUSH INTERCONTINENTAL/ HOUSTON ARPT</td>
<td class="gt_row gt_left">YOUNGSTOWN-WARREN RGNL ARPT</td>
<td class="gt_row gt_left">UNKNOWN</td></tr>
    <tr><td class="gt_row gt_left">airport_id</td>
<td class="gt_row gt_left">KBDL</td>
<td class="gt_row gt_left">ZZZZ</td>
<td class="gt_row gt_left">KIAH</td>
<td class="gt_row gt_left">KYNG</td>
<td class="gt_row gt_left">ZZZZ</td></tr>
    <tr><td class="gt_row gt_left">date</td>
<td class="gt_row gt_left">15836</td>
<td class="gt_row gt_left">13671</td>
<td class="gt_row gt_left">14762</td>
<td class="gt_row gt_left">14419</td>
<td class="gt_row gt_left">12324</td></tr>
    <tr><td class="gt_row gt_left">distance</td>
<td class="gt_row gt_left">2</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">0</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">dow</td>
<td class="gt_row gt_left">Sat</td>
<td class="gt_row gt_left">Thu</td>
<td class="gt_row gt_left">Wed</td>
<td class="gt_row gt_left">Wed</td>
<td class="gt_row gt_left">Mon</td></tr>
    <tr><td class="gt_row gt_left">engine_make</td>
<td class="gt_row gt_left">31</td>
<td class="gt_row gt_left">22</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">31</td></tr>
    <tr><td class="gt_row gt_left">engine_model</td>
<td class="gt_row gt_left">10</td>
<td class="gt_row gt_left">7</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">1</td></tr>
    <tr><td class="gt_row gt_left">engine_type</td>
<td class="gt_row gt_left">C</td>
<td class="gt_row gt_left">D</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">D</td></tr>
    <tr><td class="gt_row gt_left">engine1_position</td>
<td class="gt_row gt_left">4</td>
<td class="gt_row gt_left">1</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">5</td></tr>
    <tr><td class="gt_row gt_left">engine2_position</td>
<td class="gt_row gt_left">4</td>
<td class="gt_row gt_left">1</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">5</td></tr>
    <tr><td class="gt_row gt_left">engine3_position</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">engine4_position</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">engines</td>
<td class="gt_row gt_left">2</td>
<td class="gt_row gt_left">2</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">2</td></tr>
    <tr><td class="gt_row gt_left">faa_region</td>
<td class="gt_row gt_left">ANE</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">ASW</td>
<td class="gt_row gt_left">AGL</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">flight_impact</td>
<td class="gt_row gt_left">NONE</td>
<td class="gt_row gt_left">NONE</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">flight_phase</td>
<td class="gt_row gt_left">APPROACH</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">TAKEOFF RUN</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">height</td>
<td class="gt_row gt_left">800</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">incident_day</td>
<td class="gt_row gt_left">11</td>
<td class="gt_row gt_left">7</td>
<td class="gt_row gt_left">2</td>
<td class="gt_row gt_left">24</td>
<td class="gt_row gt_left">29</td></tr>
    <tr><td class="gt_row gt_left">incident_month</td>
<td class="gt_row gt_left">5</td>
<td class="gt_row gt_left">6</td>
<td class="gt_row gt_left">6</td>
<td class="gt_row gt_left">6</td>
<td class="gt_row gt_left">9</td></tr>
    <tr><td class="gt_row gt_left">incident_year</td>
<td class="gt_row gt_left">2013</td>
<td class="gt_row gt_left">2007</td>
<td class="gt_row gt_left">2010</td>
<td class="gt_row gt_left">2009</td>
<td class="gt_row gt_left">2003</td></tr>
    <tr><td class="gt_row gt_left">log_distance</td>
<td class="gt_row gt_left">0.693147180559945</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">-Inf</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">log_height</td>
<td class="gt_row gt_left">6.68461172766793</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">log_speed</td>
<td class="gt_row gt_left">4.74493212836325</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">4.97673374242057</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">operator</td>
<td class="gt_row gt_left">COMMUTAIR</td>
<td class="gt_row gt_left">ABX AIR</td>
<td class="gt_row gt_left">UNKNOWN</td>
<td class="gt_row gt_left">MILITARY</td>
<td class="gt_row gt_left">NETJETS</td></tr>
    <tr><td class="gt_row gt_left">operator_id</td>
<td class="gt_row gt_left">UCA</td>
<td class="gt_row gt_left">ABX</td>
<td class="gt_row gt_left">UNK</td>
<td class="gt_row gt_left">MIL</td>
<td class="gt_row gt_left">NJA</td></tr>
    <tr><td class="gt_row gt_left">precipitation</td>
<td class="gt_row gt_left">NONE</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">species_id</td>
<td class="gt_row gt_left">UNKBS</td>
<td class="gt_row gt_left">UNKBM</td>
<td class="gt_row gt_left">I1301</td>
<td class="gt_row gt_left">UNKBM</td>
<td class="gt_row gt_left">UNKBM</td></tr>
    <tr><td class="gt_row gt_left">species_name</td>
<td class="gt_row gt_left">UNKNOWN SMALL BIRD</td>
<td class="gt_row gt_left">UNKNOWN MEDIUM BIRD</td>
<td class="gt_row gt_left">CATTLE EGRET</td>
<td class="gt_row gt_left">UNKNOWN MEDIUM BIRD</td>
<td class="gt_row gt_left">UNKNOWN MEDIUM BIRD</td></tr>
    <tr><td class="gt_row gt_left">species_quantity</td>
<td class="gt_row gt_left">1</td>
<td class="gt_row gt_left">1</td>
<td class="gt_row gt_left">1</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">1</td></tr>
    <tr><td class="gt_row gt_left">speed</td>
<td class="gt_row gt_left">115</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">145</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">state</td>
<td class="gt_row gt_left">CT</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">TX</td>
<td class="gt_row gt_left">OH</td>
<td class="gt_row gt_left">NA</td></tr>
    <tr><td class="gt_row gt_left">visibility</td>
<td class="gt_row gt_left">NIGHT</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">NA</td>
<td class="gt_row gt_left">DAY</td>
<td class="gt_row gt_left">NA</td></tr>
  </tbody>
  
  
</table>
</div>
```

## Target - damaged

- unbalanced
- was a missing value


```r
summary(explore_build$damaged)
```

```
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.00000 0.00000 0.00000 0.08567 0.00000 1.00000 
```

```r
ggplot(explore_build, aes(damaged_factor, fill = damaged_factor)) +
  geom_bar() +
  scale_y_comma() +
  labs(title = 'Damaged', x = NULL, y = NULL, fill = 'Damaged') +
  guides(fill = 'none')
```

<img src="s01e02_files/figure-html/unnamed-chunk-8-1.png" width="907.086614173228" />


## Function for exploration - numeric



```r
explore_num <- function(x, ...){

a <- explore_build %>% 
  mutate(is_it_na = if_else(is.na({{x}}), 'NA', 'Present')) %>% 
ggplot(aes(is_it_na, fill = damaged_factor)) +
  geom_bar() +
  scale_y_comma() +
  labs(x = NULL, y = NULL, fill = 'Damaged') +
  guides(fill = 'none')

b <- explore_build %>% 
  mutate(is_it_na = if_else(is.na({{x}}), 'NA', 'Present')) %>% 
ggplot(aes(is_it_na, fill = damaged_factor)) +
  geom_bar(position = 'fill') +
  scale_y_pct() +
  labs(x = NULL, y = NULL, fill = 'Damaged') +
  guides(fill = 'none')

c <- ggplot(explore_build, aes({{x}}, fill = damaged_factor)) +
  geom_histogram( ...) +
  scale_y_comma() +
  labs(x = NULL, y = NULL, fill = 'Damaged') +
  guides(fill = 'none')

d <- ggplot(explore_build, aes({{x}}, fill = damaged_factor)) +
  geom_histogram(position = 'fill', ...) +
  scale_y_pct() +
  labs(x = NULL, y = NULL, fill = 'Damaged') +
  guides(fill = 'none')

(a + b) / (c + d) 

}
```

## Function for exploration - category



```r
explore_char <- function(x, ...){

c <- explore_build %>% 
  mutate(
    tmp = fct_infreq(fct_lump_n({{x}}, 20))
  ) %>% 
ggplot(aes(tmp, fill = damaged_factor)) +
  geom_bar() +
  scale_y_comma() +
  scale_x_discrete(label = label_wrap(15)) +
  labs(x = NULL, y = NULL, fill = 'Damaged') +
  coord_flip() +
  guides(fill = 'none')

d <- explore_build %>% 
  mutate(
    tmp = fct_infreq(fct_lump_n({{x}}, 20))
  ) %>% 
ggplot(aes(tmp, fill = damaged_factor)) +
  geom_bar(position = 'fill') +
  scale_y_pct() +
  scale_x_discrete(label = label_wrap(15)) +
  labs(x = NULL, y = NULL, fill = 'Damaged') +
  coord_flip() +
  guides(fill = 'none')

(c + d) 
}
```

## incident_year

Year the incident occurred (1990-2015)

- No missing data
- Rate decreasing over time



```r
explore_num(incident_year, binwidth = 1)
```

<img src="s01e02_files/figure-html/unnamed-chunk-11-1.png" width="907.086614173228" />

## incident_month

Month the incident occurred (1-12)

- Change to factor
- seasonal impact



```r
explore_num(incident_month, binwidth = 1)
```

<img src="s01e02_files/figure-html/unnamed-chunk-12-1.png" width="907.086614173228" />

## incident_day

Day the incident occurred (1-31)

- Omit raw
- Could combine with month and year to get date and use `step_date`?
- Public holidays could be an issue `step_holiday`
- Day of week might be more useful - Not useful



```r
explore_char(dow)
```

<img src="s01e02_files/figure-html/unnamed-chunk-13-1.png" width="907.086614173228" />

## operator_id / operator

International Civil Aviation Organization (ICAO) code for aircraft operators / Name of the Airline

- Omit operator_id
- some operators have higher rates


```r
explore_char(operator)
```

<img src="s01e02_files/figure-html/unnamed-chunk-14-1.png" width="907.086614173228" />

## aircraft

Model of aircraft involved in the strike

For example: B-777 means a Boeing 777 was struck in the incident


```r
explore_char(aircraft)
```

<img src="s01e02_files/figure-html/unnamed-chunk-15-1.png" width="907.086614173228" />

## aircraft_type

- 'A': "multi-engined aeroplanes powered by turbo-propeller engines with an MOPSC of more than nine or a maximum take-off mass exceeding 5 700 kg, and all multi-engined turbo-jet powered aeroplanes"
- 'B': "aeroplanes powered by propeller engines with an MOPSC of nine or less and a maximum take-off mass of 5 700 kg or less"


```r
explore_char(aircraft_type)
```

<img src="s01e02_files/figure-html/unnamed-chunk-16-1.png" width="907.086614173228" />

## aircraft_make

International Civil Aviation Organization (ICAO) code for Aircraft Make


```r
explore_char(aircraft_make)
```

<img src="s01e02_files/figure-html/unnamed-chunk-17-1.png" width="907.086614173228" />

## aircraft_model

International Civil Aviation Organization (ICAO) code for Aircraft Model

- should be factor


```r
explore_num(aircraft_model, binwidth = 10)
```

<img src="s01e02_files/figure-html/unnamed-chunk-18-1.png" width="907.086614173228" />

## aircraft_mass

- 1 = 2,250 kg or less
- 2 = 2,251-5,700 kg
- 3 = 5,701-27,000 kg
- 4 = 27,001-272,000 kg
- 5 = above 272,000 kg

- convert to factor


```r
explore_char(aircraft_mass)
```

<img src="s01e02_files/figure-html/unnamed-chunk-19-1.png" width="907.086614173228" />

## engine_make

Engine Make Code

- should be a factor


```r
explore_num(engine_make, binwidth = 1)
```

<img src="s01e02_files/figure-html/unnamed-chunk-20-1.png" width="907.086614173228" />

## engine_model

Engine Model Code


```r
explore_char(engine_model)
```

<img src="s01e02_files/figure-html/unnamed-chunk-21-1.png" width="907.086614173228" />

## engines

Number of engines powering the aircraft


```r
explore_num(engines, binwidth = 1)
```

<img src="s01e02_files/figure-html/unnamed-chunk-22-1.png" width="907.086614173228" />

## engine_type

The way the engine is powered

- 'A' - Reciprocating
- 'B' - Turbojet
- 'C' - Turboprop
- 'D' - Turbofan
- 'E' - None (glider)
- 'F' - Turboshaft (helicopter)
- Special Note: Some aircrafts can have two engine types
  - Example: 'B/D'


```r
explore_char(engine_type)
```

<img src="s01e02_files/figure-html/unnamed-chunk-23-1.png" width="907.086614173228" />

## engine1_position

Where engine 1 is mounted on aircraft

- should be  factor


```r
explore_num(engine1_position)
```

```
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
```

<img src="s01e02_files/figure-html/unnamed-chunk-24-1.png" width="907.086614173228" />

## engine2_position

Where engine 2 is mounted on aircraft

- should be a factor


```r
explore_num(engine2_position)
```

```
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
```

<img src="s01e02_files/figure-html/unnamed-chunk-25-1.png" width="907.086614173228" />

## engine3_position

Where engine 3 is mounted on aircraft

- omit

## engine4_position

Where engine 4 is mounted on aircraft

- omit

## airport_id / airport

Location of the strike given as the International Civil Aviation Organization (ICAO) airport identifier / Name of the airport where the strike occurred


```r
explore_char(airport)
```

<img src="s01e02_files/figure-html/unnamed-chunk-26-1.png" width="907.086614173228" />

## state

Abbreviated state from US, Canada


```r
explore_char(state)
```

<img src="s01e02_files/figure-html/unnamed-chunk-27-1.png" width="907.086614173228" />

## faa_region
FAA region where the airport is located

- The US has 9 regions (AAL, ACE, AEA, AGL, ANE, ANM, ASO, ASW, AWP)
- Canada has 5 regions (ATL, AWP, ONT, P&N, PAC, QUE)
- All other regions of the world are considered foreign regions (FGN)


```r
explore_char(faa_region)
```

<img src="s01e02_files/figure-html/unnamed-chunk-28-1.png" width="907.086614173228" />

## flight_phase

Phase of flight during which the strike occured

- APPROACH
- ARRIVAL
- CLIMB
- DEPARTURE
- DESCENT
- EN ROUTE
- LANDING
- LANDING ROLL
- LOCAL
- PARKED
- TAKEOFF RUN
- TAXI


```r
explore_char(flight_phase)
```

<img src="s01e02_files/figure-html/unnamed-chunk-29-1.png" width="907.086614173228" />


## visibility

Time of day when the strike occurred

- DAWN
- DAY
- DUSK
- NIGHT
- UNKNOWN


```r
explore_char(visibility)
```

<img src="s01e02_files/figure-html/unnamed-chunk-30-1.png" width="907.086614173228" />

## precipitation

- FOG
 -RAIN
- SNOW
- NONE
- Special Note: Can have multiple values
  - Example: FOG, RAIN
  
- Is it worth splitting?  


```r
explore_char(precipitation)
```

<img src="s01e02_files/figure-html/unnamed-chunk-31-1.png" width="907.086614173228" />

## height

Feet About Ground Level where the strike occurred (0-24,000)


```r
explore_num(height, bins = 50)
```

<img src="s01e02_files/figure-html/unnamed-chunk-32-1.png" width="907.086614173228" />

Try log


```r
explore_num(log_height, bins = 50)
```

<img src="s01e02_files/figure-html/unnamed-chunk-33-1.png" width="907.086614173228" />

## speed

Velocity in Knots (0-2500)

- trim high values


```r
explore_num(speed, bins = 50)
```

<img src="s01e02_files/figure-html/unnamed-chunk-34-1.png" width="907.086614173228" />

Try log


```r
explore_num(log_speed, bins = 50)
```

<img src="s01e02_files/figure-html/unnamed-chunk-35-1.png" width="907.086614173228" />

## distance

How many miles from the airport (0-100)


```r
explore_num(distance, binwidth = 5)
```

<img src="s01e02_files/figure-html/unnamed-chunk-36-1.png" width="907.086614173228" />

Try log


```r
explore_num(log_distance, bins = 50)
```

<img src="s01e02_files/figure-html/unnamed-chunk-37-1.png" width="907.086614173228" />

## species_id / species_name

International Civil Aviation Organization (ICAO) code for type of wildlife / Common name for type of wildlife struck

- just use name


```r
explore_char(species_name)
```

<img src="s01e02_files/figure-html/unnamed-chunk-38-1.png" width="907.086614173228" />

## species_quantity

Amount of wildlife struck

- 1
- 2-10
- 11-100
- Over 100



```r
explore_char(species_quantity)
```

<img src="s01e02_files/figure-html/unnamed-chunk-39-1.png" width="907.086614173228" />

## flight_impact

How the strike impacted the flight

- ABORTED
- TAKEOFF
- ENGINE SHUTDOWN
- NONE
- OTHER
- PRECAUTIONARY LANDING


```r
explore_char(flight_impact)
```

<img src="s01e02_files/figure-html/unnamed-chunk-40-1.png" width="907.086614173228" />

# Split in to train and test


```r
set.seed(728)

to_build <- to_build %>% 
  filter(! is.na(damaged)) %>% 
  mutate(damaged = factor(damaged, levels = c(1, 0)))

split <- initial_split(to_build, strata = damaged)
train <- training(split)
test <- testing(split)
```

# Create folds


```r
set.seed(530)
train_folds <- vfold_cv(train, 5)
```


# Create recipe


```r
rec <- recipe(damaged ~ ., data = train) %>%
  # id role
  update_role(id, new_role = "ID") %>%
  # create variables
  step_mutate(
    speed = if_else(speed > 500, 500, speed)
  ) %>% 
  # numbers to characters
  step_mutate(
    incident_month = as.character(incident_month), 
    aircraft_mass = as.character(aircraft_mass), 
    aircraft_model = as.character(aircraft_model), 
    engine_make = as.character(engine_make), 
    engine1_position = as.character(engine1_position), 
    engine2_position = as.character(engine2_position),
    engines = as.character(engines)
  ) %>% 
  # remove variables
  step_rm(operator_id, operator, incident_day, species_id, airport_id, 
    engine3_position, engine4_position, aircraft, state, aircraft_model,
    engine_make, engine_model, aircraft_make, airport, distance) %>%
  # flag for missing values
  step_indicate_na(height, speed) %>% 
  # imputation of missing values
  step_impute_mean(height, speed) %>% 
  # character to factors
  step_string2factor(all_nominal_predictors()) %>% 
  # explicit na
  step_unknown(all_nominal_predictors()) %>% 
  # handle new classes
  step_novel(all_nominal(), -all_outcomes()) %>% 
  # lump together small values
  step_other(all_nominal_predictors()) %>% 
  # all numeric
  step_dummy(all_nominal_predictors()) %>% 
  # remove if zero variance
  step_zv(all_predictors()) %>% 
  # rebalance
  step_downsample(damaged)
```

# Check recipe outputs


```r
prepped <- prep(rec)
baked <- bake(prepped, new_data = NULL) 

skim(baked)
```


<table style='width: auto;'
        class='table table-condensed'>
<caption>Data summary</caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;">   </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Name </td>
   <td style="text-align:left;"> baked </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of rows </td>
   <td style="text-align:left;"> 2612 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of columns </td>
   <td style="text-align:left;"> 57 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> _______________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Column type frequency: </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> factor </td>
   <td style="text-align:left;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> numeric </td>
   <td style="text-align:left;"> 56 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ________________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Group variables </td>
   <td style="text-align:left;"> None </td>
  </tr>
</tbody>
</table>


**Variable type: factor**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:left;"> ordered </th>
   <th style="text-align:right;"> n_unique </th>
   <th style="text-align:left;"> top_counts </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> damaged </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> FALSE </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:left;"> 1: 1306, 0: 1306 </td>
  </tr>
</tbody>
</table>


**Variable type: numeric**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:right;"> mean </th>
   <th style="text-align:right;"> sd </th>
   <th style="text-align:right;"> p0 </th>
   <th style="text-align:right;"> p25 </th>
   <th style="text-align:right;"> p50 </th>
   <th style="text-align:right;"> p75 </th>
   <th style="text-align:right;"> p100 </th>
   <th style="text-align:left;"> hist </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> id </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 14959.53 </td>
   <td style="text-align:right;"> 8582.28 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 7622.75 </td>
   <td style="text-align:right;"> 15026.00 </td>
   <td style="text-align:right;"> 22121.75 </td>
   <td style="text-align:right;"> 30000 </td>
   <td style="text-align:left;"> ▇▇▇▇▇ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> incident_year </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2004.79 </td>
   <td style="text-align:right;"> 7.02 </td>
   <td style="text-align:right;"> 1990 </td>
   <td style="text-align:right;"> 2000.00 </td>
   <td style="text-align:right;"> 2006.00 </td>
   <td style="text-align:right;"> 2011.00 </td>
   <td style="text-align:right;"> 2015 </td>
   <td style="text-align:left;"> ▃▅▆▆▇ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> height </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1018.77 </td>
   <td style="text-align:right;"> 1850.34 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 3.00 </td>
   <td style="text-align:right;"> 836.68 </td>
   <td style="text-align:right;"> 836.68 </td>
   <td style="text-align:right;"> 24000 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> speed </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 142.35 </td>
   <td style="text-align:right;"> 34.66 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 140.00 </td>
   <td style="text-align:right;"> 141.74 </td>
   <td style="text-align:right;"> 141.74 </td>
   <td style="text-align:right;"> 350 </td>
   <td style="text-align:left;"> ▁▇▂▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> na_ind_height </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.32 </td>
   <td style="text-align:right;"> 0.47 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▃ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> na_ind_speed </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.52 </td>
   <td style="text-align:right;"> 0.50 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▇ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> incident_month_X11 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.09 </td>
   <td style="text-align:right;"> 0.29 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> incident_month_X3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.07 </td>
   <td style="text-align:right;"> 0.25 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> incident_month_X4 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.08 </td>
   <td style="text-align:right;"> 0.27 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> incident_month_X5 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.09 </td>
   <td style="text-align:right;"> 0.29 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> incident_month_X6 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.07 </td>
   <td style="text-align:right;"> 0.26 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> incident_month_X7 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.10 </td>
   <td style="text-align:right;"> 0.29 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> incident_month_X8 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.13 </td>
   <td style="text-align:right;"> 0.33 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> incident_month_X9 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.13 </td>
   <td style="text-align:right;"> 0.33 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> incident_month_other </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.13 </td>
   <td style="text-align:right;"> 0.33 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> aircraft_type_unknown </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.14 </td>
   <td style="text-align:right;"> 0.34 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> aircraft_type_other </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> aircraft_mass_X4 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.48 </td>
   <td style="text-align:right;"> 0.50 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▇ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> aircraft_mass_unknown </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.17 </td>
   <td style="text-align:right;"> 0.37 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▂ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> aircraft_mass_other </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.21 </td>
   <td style="text-align:right;"> 0.41 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▂ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engines_unknown </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.17 </td>
   <td style="text-align:right;"> 0.37 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▂ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engines_other </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.17 </td>
   <td style="text-align:right;"> 0.37 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▂ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine_type_D </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.60 </td>
   <td style="text-align:right;"> 0.49 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▅▁▁▁▇ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine_type_unknown </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.17 </td>
   <td style="text-align:right;"> 0.37 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▂ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine_type_other </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.14 </td>
   <td style="text-align:right;"> 0.34 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine1_position_X4 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.11 </td>
   <td style="text-align:right;"> 0.31 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine1_position_X5 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.24 </td>
   <td style="text-align:right;"> 0.43 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▂ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine1_position_unknown </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.38 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▂ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine1_position_other </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.11 </td>
   <td style="text-align:right;"> 0.31 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine2_position_X4 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.11 </td>
   <td style="text-align:right;"> 0.31 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine2_position_X5 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.21 </td>
   <td style="text-align:right;"> 0.41 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▂ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine2_position_unknown </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0.45 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▃ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> engine2_position_other </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.05 </td>
   <td style="text-align:right;"> 0.22 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> faa_region_AGL </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.13 </td>
   <td style="text-align:right;"> 0.34 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> faa_region_ANM </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.08 </td>
   <td style="text-align:right;"> 0.26 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> faa_region_ASO </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.37 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▂ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> faa_region_ASW </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.11 </td>
   <td style="text-align:right;"> 0.32 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> faa_region_AWP </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.12 </td>
   <td style="text-align:right;"> 0.33 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> faa_region_unknown </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.15 </td>
   <td style="text-align:right;"> 0.36 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▂ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> faa_region_other </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.10 </td>
   <td style="text-align:right;"> 0.30 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> flight_phase_CLIMB </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.36 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▂ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> flight_phase_LANDING.ROLL </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.11 </td>
   <td style="text-align:right;"> 0.32 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> flight_phase_TAKEOFF.RUN </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.13 </td>
   <td style="text-align:right;"> 0.34 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> flight_phase_unknown </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.23 </td>
   <td style="text-align:right;"> 0.42 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▂ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> flight_phase_other </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.09 </td>
   <td style="text-align:right;"> 0.29 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> visibility_NIGHT </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.22 </td>
   <td style="text-align:right;"> 0.42 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▂ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> visibility_unknown </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0.45 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▃ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> visibility_other </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.05 </td>
   <td style="text-align:right;"> 0.22 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> precipitation_unknown </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.42 </td>
   <td style="text-align:right;"> 0.49 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▆ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> precipitation_other </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.06 </td>
   <td style="text-align:right;"> 0.23 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> species_name_UNKNOWN.SMALL.BIRD </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.12 </td>
   <td style="text-align:right;"> 0.33 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> species_name_other </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.61 </td>
   <td style="text-align:right;"> 0.49 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▅▁▁▁▇ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> species_quantity_X2.10 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.37 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▂ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> species_quantity_other </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> flight_impact_unknown </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.33 </td>
   <td style="text-align:right;"> 0.47 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▃ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> flight_impact_other </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.39 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> ▇▁▁▁▂ </td>
  </tr>
</tbody>
</table>

# Specify model


```r
xgboost_spec <- boost_tree(
    trees = 2000, 
    min_n = 23, 
    tree_depth = 15, 
    learn_rate = 0.00591673615298013, 
    loss_reduction = 3.41525742335076e-07, 
    sample_size = 0.648717504832894
  ) %>% 
  set_mode("classification") %>% 
  set_engine("xgboost") %>%
  set_args(importance = "impurity")
```

# Specify workflow


```r
xgboost_workflow <- workflow() %>% 
  add_recipe(rec) %>% 
  add_model(xgboost_spec) 

xgboost_workflow
```

```
══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: boost_tree()

── Preprocessor ────────────────────────────────────────────────────────────────
12 Recipe Steps

• step_mutate()
• step_mutate()
• step_rm()
• step_indicate_na()
• step_impute_mean()
• step_string2factor()
• step_unknown()
• step_novel()
• step_other()
• step_dummy()
• ...
• and 2 more steps.

── Model ───────────────────────────────────────────────────────────────────────
Boosted Tree Model Specification (classification)

Main Arguments:
  trees = 2000
  min_n = 23
  tree_depth = 15
  learn_rate = 0.00591673615298013
  loss_reduction = 3.41525742335076e-07
  sample_size = 0.648717504832894

Engine-Specific Arguments:
  importance = impurity

Computational engine: xgboost 
```

# Tune

Tuning happened but won't be included because it took so long.  


```r
xgboost_metric <- metric_set(mn_log_loss)

set.seed(34379)
xgboost_tune <- tune_grid(
  xgboost_workflow, 
  resamples = train_folds, 
  grid = 9,
  metrics = xgboost_metric
 )
```

## Tuning outcome

The results were:

- trees = 2000
- min_n = 23
- tree_depth = 15
- learn_rate = 0.00591673615298013
- loss_reduction = 3.41525742335076e-07
- sample_size = 0.648717504832894



```r
show_best(xgboost_tune, metric = "mn_log_loss") %>%
  gt()

autoplot(xgboost_tune) +
  theme_bw()
```

# Finalise model


```r
final_wkflow <- xgboost_workflow #%>%
  #finalize_workflow(select_best(xgboost_tune, metric = "mn_log_loss"))

final_wkflow
```

```
══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: boost_tree()

── Preprocessor ────────────────────────────────────────────────────────────────
12 Recipe Steps

• step_mutate()
• step_mutate()
• step_rm()
• step_indicate_na()
• step_impute_mean()
• step_string2factor()
• step_unknown()
• step_novel()
• step_other()
• step_dummy()
• ...
• and 2 more steps.

── Model ───────────────────────────────────────────────────────────────────────
Boosted Tree Model Specification (classification)

Main Arguments:
  trees = 2000
  min_n = 23
  tree_depth = 15
  learn_rate = 0.00591673615298013
  loss_reduction = 3.41525742335076e-07
  sample_size = 0.648717504832894

Engine-Specific Arguments:
  importance = impurity

Computational engine: xgboost 
```


# Fit model


```r
xgboost_fit <- last_fit(final_wkflow, split, metric = "mn_log_loss")
```

# Check performance


```r
collect_metrics(xgboost_fit, metric = "mn_log_loss") %>%
  gt()
```

```{=html}
<div id="rwoqbgusap" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#rwoqbgusap .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rwoqbgusap .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rwoqbgusap .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rwoqbgusap .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rwoqbgusap .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rwoqbgusap .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rwoqbgusap .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rwoqbgusap .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rwoqbgusap .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rwoqbgusap .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rwoqbgusap .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rwoqbgusap .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#rwoqbgusap .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rwoqbgusap .gt_from_md > :first-child {
  margin-top: 0;
}

#rwoqbgusap .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rwoqbgusap .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rwoqbgusap .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#rwoqbgusap .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rwoqbgusap .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#rwoqbgusap .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rwoqbgusap .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rwoqbgusap .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rwoqbgusap .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rwoqbgusap .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rwoqbgusap .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#rwoqbgusap .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rwoqbgusap .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#rwoqbgusap .gt_left {
  text-align: left;
}

#rwoqbgusap .gt_center {
  text-align: center;
}

#rwoqbgusap .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rwoqbgusap .gt_font_normal {
  font-weight: normal;
}

#rwoqbgusap .gt_font_bold {
  font-weight: bold;
}

#rwoqbgusap .gt_font_italic {
  font-style: italic;
}

#rwoqbgusap .gt_super {
  font-size: 65%;
}

#rwoqbgusap .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.metric</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">.estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.config</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">accuracy</td>
<td class="gt_row gt_left">binary</td>
<td class="gt_row gt_right">0.7525714</td>
<td class="gt_row gt_left">Preprocessor1_Model1</td></tr>
    <tr><td class="gt_row gt_left">roc_auc</td>
<td class="gt_row gt_left">binary</td>
<td class="gt_row gt_right">0.8692779</td>
<td class="gt_row gt_left">Preprocessor1_Model1</td></tr>
  </tbody>
  
  
</table>
</div>
```

# Get predictions


```r
xgboost_preds <- collect_predictions(xgboost_fit)
```

# ROC Curve


```r
xgboost_preds %>%
  roc_curve(damaged, .pred_1) %>% 
  autoplot()
```

<img src="s01e02_files/figure-html/unnamed-chunk-53-1.png" width="907.086614173228" />

# Apply to new data



```r
have_scored <- cbind(
    to_score %>% select(id), 
    predict(xgboost_fit$.workflow[[1]], to_score, type = 'prob')
  ) %>%
  select(id, damaged = .pred_1)
```

# Compare distribution for Test vs Holdout


```r
xgboost_preds %>%
  select(damaged = .pred_1) %>% 
  mutate(pop = 'Test') %>% 
  union_all(have_scored) %>% 
  mutate(pop = if_else(is.na(pop), 'Holdout', pop)) %>% 
ggplot(aes(damaged, fill = pop, colour= pop)) +
  geom_density(alpha = 0.3)
```

<img src="s01e02_files/figure-html/unnamed-chunk-55-1.png" width="907.086614173228" />

# Use the damaged rate instead


```r
use_mean <- mean(have_scored$damaged)

have_scored <- have_scored %>% 
  mutate(damaged = use_mean)
```

# Output submission


```r
write_csv(have_scored, 's01e02/submission.csv')
```

# Outcome

Score of 0.42.  Not great.  Can get 0.186 from using 0.06607 probability for all.  Wonder if there's something wrong with the files.

# Learnings

- Check whether the submission is for class or probability and use `type = 'prob'` in the `predict()` statement for the latter.
- Used several new steps

# More to learn

- Get the variable name into the chart titles when using a function
- Look at variable importance
